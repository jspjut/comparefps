# Comparing refresh rates

This repository contains a [FPSci](github.com/NVLabs/FPSci) user study experiment to figure out which refresh rates above 144 hz you can tell the difference between. 

## How to run

1. Double click `setup.bat`, which is a script to set up the experiment by downloading the required version of FPSci, and copy the experiment configuration files into the right location. `setup.sh` is the bash equivalent if you prefer that.
2. Double click `RunFPSci.bat` or double click on `FirstPersonScience.exe` inside the `FPSci` directory (created by the download and extract in the script).

3. After the experiment, there will be a results file in the results directory that you can analyze, or provide to the authors for analysis.

4. (optional) If something goes wrong and you need to start over, you can delete the `FPSci` directory, and return to step 1 above.

## For developers and experiment designers

Users or people running the experiment don't need to worry about this part. As a developer or experiment designer, all of the needed configs are generated by scripts in the `scripts` directory. The top level script is `make_configs.py` which is all you need to run (from the root of the repository) to update the generated configs. In order to make this repository useful for users, the configs are checked in as well, which is why they are not included in the `.gitignore`. The configs are copied into the downloaded FPSci build for the experiment by the `setup.sh` script.

A development workflow may include the following shell commands intermingled with editing scripts or config files (under `configs`).

* `python ./scripts/make_configs.py` - Generate new versions of the generated configs in `configs/`
* `./scripts/update.sh` - Copies the configs from `configs/` to `FPSci` to prepare to test
* `python ./scripts/make_configs.py && ./scripts/update.sh && start RunFPSci.bat` - all of the above plus run

If you need to use a different version of FPSci, you can update the version number in `setup.sh` and run it again. You may need to delete the `FPSci` directory and contents to prevent conflicting file versions. **Warning:** If you have captured data you want to hold on to, you may need to back it up somewhere else to avoid losing it.

For configs you choose to generate with `make_configs.py`, you can use git to track the changes made as you iterate on the experiment design.

While you can choose to generate any configs you want, it's generally recommended to modifying the `startupconfig.Any` directly to generate `experimentconfig.Any`, `userconfig.Any` and `userstatus.Any`. If there's a particular keymap you want, you can generate, or directly modify that as well.

## Analysis
This sql query is useful for analyzing the responses.

```
SELECT task_id, 
SUM(CASE WHEN better = "144" THEN 1 ELSE 0 END) as low,
SUM(CASE WHEN better != "144" THEN 1 ELSE 0 END) as hi,
avg(better) as average_of_better
FROM (
	SELECT t.task_id ,CASE WHEN q.response IS "First" THEN SUBSTRING(t.trial_order,4,3) ELSE SUBSTRING(t.trial_order,11,3) END AS better
	FROM Questions q, Tasks t
	WHERE q.time BETWEEN t.start_time AND t.end_time
)
GROUP BY task_id
```

This sql query is useful for verifying the conditions worked as expected in terms of frame times.

```
SELECT trial_id, avg(sdt)
FROM Trials t, Frame_Info f
WHERE f.time BETWEEN t.start_time AND t.end_time
GROUP BY trial_id
```
